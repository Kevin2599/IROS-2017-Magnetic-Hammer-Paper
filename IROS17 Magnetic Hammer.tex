

\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper
\usepackage{graphicx}


%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper

\IEEEoverridecommandlockouts                              % This command is only needed if 
                                                          % you want to use the \thanks command

\overrideIEEEmargins                                      % Needed to meet printer requirements.

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

% The following packages can be found on http:\\www.ctan.org
%\usepackage{graphics} % for pdf, bitmapped graphics files
%\usepackage{epsfig} % for postscript graphics files
%\usepackage{mathptmx} % assumes new font selection scheme installed
%\usepackage{times} % assumes new font selection scheme installed
%\usepackage{amsmath} % assumes amsmath package installed
%\usepackage{amssymb}  % assumes amsmath package installed
\usepackage{cite}
\usepackage{mathtools}
\usepackage{cleveref}


\title{\LARGE \bf
Magnetic Hammer Actuation for Tissue Penetration using Millirobots
}


\author{Julien Leclerc, Ashwin Ramakrishnan, Nikolaos V. Tsekos and Aaron T. Becker % <-this % stops a space
\thanks{This work was supported by the National Science Foundation, Grant No. 1646566. }% <-this % stops a space
\thanks{Authors are with the Dept. of Electrical and Computer
Engineering, University of Houston, Houston, TX 70004, USA
        {\tt\small jleclerc@uh.edu}}%
%\thanks{$^{2}$Bernard D. Researcheris with the Department of Electrical Engineering, Wright State University,
%       Dayton, OH 45435, USA
%      {\tt\small b.d.researcher@ieee.org}}%
}


\begin{document}



\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}

Untethered magnetic navigation of millirobots within a human body using an MRI scanner is a promising technology for minimally invasive surgery or drug delivery. However, the magnetic field and gradient values are too small to produce forces large enough to penetrate tissue. This paper presents a method to produce large pulsed forces on millirobots. A ferromagnetic sphere is placed inside the robot body and can move back and forth. This movement is created by alternatively changing the magnetic gradient direction. On the posterior side, a spring allows the sphere to change direction smoothly. On the forward side, a hard rod creates a surface for the sphere to impact. This impact results in a large pulsed force. This system has first been modeled and simulated. A control strategie is presented and experimentally tested. Finally, preliminary tests inside a clinical MRI scanner were performed. 

\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUCTION}

The navigation of millimeter-scale robots through the passageways of bodies is currently being studied as a method to perform highly localized drug delivery or perform minimally invasive surgery \cite{7067029,702,mi2020295}. Untethered navigation can be achieved by placing a ferromagnetic piece inside the robot and producing a controlled magnetic field around a patient. Propulsion and steering of millirobots can be accomplished by either moving a permanent magnet assembly around a patient \cite{taylor} or by controlling the current inside electromagnets \cite{MRM21638}. The latest solution is often realized with an MRI scanner which already includes several electromagnets. In that case, the background field magnetizes the ferrous piece of the robot, and the gradients coils produce the magnetic gradient necessary to produce forces. The MRI scanner can be used simultaneously to provide real-time imaging of the operating area as well as positioning of the robots.\par
The value of the forces generated on the millirobots is proportional to the field gradient strength. Commercial MRI scanner produces gradients in the range of 20 to 40 mT/m. This value could allow the navigation of robots through the body fluids but not the penetration of tissues. Tissue penetration indeed requires larger forces \cite{7139341}. This paper presents a method that allows producing large pulsed forces for tissue penetration. This system has been called magnetic hammer.\par
The magnetic hammer is a system embedded into the millirobot. The millirobot has a tubular structure in which a ferromagnetic sphere can move back and forth. This movement is produced by alternatively changing the gradient direction. On the posterior side of the millirobot, a spring allows the sphere to change direction smoothly. On the forward side, a hard rod creates a surface for the sphere to impact (impact plate). This impact results in large pulsed forces that allow penetrating body tissues progressively.
A magnetic test bench has been developed to make experimental tests more practical and less expensive. It includes coils, sensors, power electronics and a real-time controller.\par

\begin{figure}
  \includegraphics[width=\linewidth]{figure1-2.png}
  \caption{Schematic representation of a millirobot actuated by a magnetic hammer}
  \label{millirobot}
\end{figure}

The paper is organized as follow: first, the system is mathematically modeled, and its behavior is studied in \cref{theoretical}. Secondly, parameters for the model are experimentally measured (see \cref{cor_det}). Different materials for the impact plate are compared. Thirdly, the magnetic test bench is described and the test of a magnetic hammer is presented (see \cref{experiment}). Results are compared to the mathematical model. Next, preliminary open loop test performed in a clinical MRI scanner are presented in \cref{MRI_tests}.The last section (\cref{conclusion}) is a conclusion of this study.


\section{Theoretical study}
\label{theoretical}
\subsection{Mechanical modelization}
The motion of the sphere between two consecutive impacts can be divided into 2  phases, based on the forces that act on it. The magnetic gradient force $F_{mag}$ and friction force $F_{friction}$ act on the sphere during its motion along the free length of the tube, $L$ (See Fig. \ref{FBD} (i),(ii)). When the spring is compressed, its reaction force $F_{spring}$ acts on the ball as well (See Fig. \ref{FBD} (iii)). The directions of $F_{mag}$ and $F_{friction}$  change depending on the direction of motion of the sphere. Inside the homogeneity sphere of an MRI machine, the magnitude of $F_{mag}$ is constant in all three Cartesian directions \cite{CMR:CMR20163}. Outside of the homogeneity sphere, the force can be calculated using the method presented in \cref{magfield,magforce}. Friction is first considered to be negligible because of the relatively low weight of the sphere, and assuming perfect rolling. The spring force calculation is straightforward, and is given by:

The motion of the sphere between two consecutive impacts can be divided into 2  phases, based on the forces that act on it. The magnetic gradient force $F_{mag}$ and friction force $F_{friction}$ act on the sphere during its motion along the free length of the tube, $L$ (See Fig. \ref{FBD} (i),(ii)). When the spring is compressed, its reaction force $F_{spring}$ acts on the ball as well (See Fig. \ref{FBD} (iii)). The directions of $F_{mag}$ and $F_{friction}$  change depending on the direction of motion of the sphere. 

\begin{figure}
	\includegraphics[width=\linewidth]{FBD.eps}
	\caption{(i) Free length of sphere travel, $L$; (ii) Free body diagram of sphere when spring is not compressed, (iii) when spring is compressed}
	\label{FBD}
\end{figure}

Inside an MRI machine, the magnitude of $F_{mag}$ is constant in all three Cartesian directions \cite{CMR:CMR20163}. The same has been assumed for developing analytical and numerical models in this paper. The formula for calculating $F_{mag}$ is presented in  \cref{force}. Friction is considered to be negligible because of the relatively low weight of the sphere, and assuming perfect rolling. The spring force is straightforward, and is given by,

\begin{equation}
F_{\text{spring}}=k x
\label{spring_force}
\end{equation}

where $x$ is the compression length, and $k$ is the spring constant. To maximize the average impact velocity over an arbitrary $n$ number of contacts, the input magnetic gradient should always be in the same direction as the motion of the sphere. This is equivalent to a perfectly closed-loop system where the gradient signal switches direction along with the sphere, as shown in (\ref{Closed_loop_gradient}).

\begin{equation}
F_{\text{mag}}=
\begin{array}{cc}
\{ & 
\begin{array}{cc}
+\left|\mathbf{M}\right|  G_x, &x' (t)\geq 0 \\
-\left|\mathbf{M}\right|  G_x, &x' (t)<0 \\
\end{array}
\\
\end{array}
\label{Closed_loop_gradient}
\end{equation}
\linebreak
\textbf{M} in the above equation represents the magnetization vector, while $G_x$ represents the $x$ component of the magnetic flux density produced by the gradient coils (Refer \cref{magfield,mag2}). An analytical model was developed by solving the system ODE, to predict the impact velocity for each impact, given a set of input parameters. The sphere-impact plate system is assumed to have a coefficient of restitution, $e$. The impact velocities for different values of $e$ are plotted in figure \ref{Closedloop_Impact_velocity}.
For all values of $e$, the impact velocity initially increases and ultimately saturates, reaching a resonant value. This happens when the energy lost by the sphere during impact equals the energy gained by it during the rest of the cycle. As expected, a higher $e$ results in a higher impact velocity. Figure \ref{CLinput} shows a sample closed-loop pulsed magnetic gradient input for 50 impacts. It is observed that the frequency initially varies until it settles to a constant value at resonance. An analytical formula was derived to predict the resonant impact velocity, for a given set of input parameters. This is given by \cref{Resonant_CLvelocity}.


An analytical model was developed for the case of an homogeneous magnetic field and gradient. The differential equation system that predicts the impact velocity for each impact given a set of input parameters was solved. The output of this model is shown in figure \ref{Closedloop_Impact_velocity}.
The impact velocity initially increases and ultimately saturates, reaching a resonant/steady-state value. This happens when the energy lost by the sphere during impact equals the energy gained by it during the rest of the cycle. An analytical formula was derived to predict the resonant/steady-state impact velocity, for a given set of input parameters. This is given by \cref{Resonant_CLvelocity}.


\begin{figure}
	\includegraphics[width=\linewidth]{Closedloop_Impact_velocity.eps}
	\caption{Closed loop impact velocity for 150 impacts; $k$ = 50 N/m; $e$ = 0.9; $F_{mag}$ = 1.5e-3 N; $L$ = 0.03 m; $m_s$ = 5.58e-4 kg; $r_s$ = 2.5 mm.}
	\label{Closedloop_Impact_velocity}
	
\end{figure}

\begin{equation}
\resizebox{\linewidth}{!}
{$
v_{\text{res}}=\frac{2 \sqrt{\frac{F_{\text{mag}} \left(\left(e^2+1\right) F_{\text{mag}}-\left(e^2-1\right) k L+\sqrt{\left(2-2 e^4\right) k L F_{\text{mag}}+\left(1+e^2\right)^2 F_{\text{mag}}^2}\right)}{k m}}}{1-e^2}
$}
\label{Resonant_CLvelocity}
\end{equation}

In the above equation, $m_s$ is the mass of the sphere in kgs. The radius of the ball $r_s$ indirectly influences the impact velocity through $F_{mag}$ and $m_s$, both of which depend on the volume of the sphere. The variation of $v_{res}$ with changes in $L,e,k,m_s,r_s,F_{mag}$ were plotted and they were all found to be monotonic functions with no critical points. Further, the time between impacts at resonance is a constant value and is given by \cref{tres1,tres2,tres3,tres4,tres5,tres6}.
	
\begin{equation}
\label{Resonant_CLvelocity}
\scriptsize
v_{\text{imp},\text{SS}}=\frac{2 \sqrt{\frac{F_{\text{mag}} \left(\left(e^2+1\right) F_{\text{mag}}-\left(e^2-1\right) k L+\sqrt{\left(2-2 e^4\right) k L F_{\text{mag}}+\left(1+e^2\right)^2 F_{\text{mag}}^2}\right)}{k m_s}}}{1-e^2}
\end{equation}
\begin{equation}
t_1=\frac{\sqrt{\frac{2 L F_{\text{mag}}}{m_b}+e^2 v_{\text{res}}^2}-e v_{\text{res}}}{\frac{F_{\text{mag}}}{m_b}}
%\label{tres1}
\end{equation}
\begin{equation}
t_2=\frac{\pi -\tan ^{-1}\left(\frac{k \sqrt{\frac{2 L F_{\text{mag}}}{m_b}+e^2 v_{\text{res}}^2}}{\omega  F_{\text{mag}}}\right)}{\omega }
\label{tres2}
\end{equation}
\begin{equation}
t_3=\frac{\cos ^{-1}\left(\frac{F_{\text{mag}}}{F_{\text{mag}}+k x_{cs}}\right)}{\omega }
\label{tres3}
\end{equation}
\begin{equation}
t_4=\frac{v_{\text{res}}-\sqrt{v_{\text{res}}^2-\frac{2 L F_{\text{mag}}}{m_b}}}{\frac{F_{\text{mag}}}{m_b}}
\label{tres4}
\end{equation}
\begin{equation}
y_0=\frac{\sqrt{e^2 k m_b v_{\text{res}}^2+2 k L F_{\text{mag}}+F_{\text{mag}}^2}+F_{\text{mag}}}{k}
\label{tres5}
\end{equation}
\begin{equation}
t_{\text{res}}=t_1+t_2+t_3+t_4
\label{tres6}
\end{equation}

In (\ref{tres4}), $x_{cs}$ is the maximum compression distance of the spring, in m (See Fig. \ref{FBD} (i)). This value can be used to select an appropriate free length for the spring, to ensure that it does not bottom out during compression. The values $t_1$ to $t_4$ represent the time for the ball to move from $x_S =$ (i) $L$ to 0, (ii) 0 to $x_{cs}$, (iii) $x_{cs}$ tp 0, and (iv) 0 to $L$ respectively, in a closed loop system. The total time between impacts at resonance is given by $t_{res}$. 






In the above equation, $e$ is the coefficient of restitution for the sphere-impact plate, and $m_s$ is the mass of the sphere in kilograms.


\begin{figure}
	\includegraphics[width=\linewidth]{CLinput.pdf}
	\caption{Closed loop input gradient for 50 impacts; $k$ = 50 N/m; $e$ = 0.9; $F_{mag}$ = 1.5e-3 N; $L$ = 0.03 m; $m_s$ = 5.58e-4 kg; $r_s$ = 2.5 mm.}
\label{CLinput}
	
\end{figure}

\subsection{Magnetic field calculation}
\label{magfield}
The magnetic field generated by an MRI scanner can be separated into two components. The first is a constant and strong magnetic field $B_0$. This field is used to align the magnetic moments of the protons. Commercial MRI scanners have $B_0$ typically ranging from 1.5 to 3 T. The second component of the field is the magnetic gradient. It is used to encode the MRI signal spatially. The flux density $\mathbf{G}$ produced by the gradient coils is superposed to $B_0$ and linearly varies with position. A computer controls its value.\par
The modelization of the field inside the uniformity sphere of an MRI scanner is straightforward. It is the sum of $B_0$ and $\mathbf{G}$. $\mathbf{G}$ is directly proportional to the current inside the gradient coils. 

\begin{equation}
\mathbf{B}=\mathbf{B_0}+\mathbf{G},~~~
\mathbf{B_0}=\begin{bmatrix}
0\\ 
0\\ 
B_0
\end{bmatrix},~
\mathbf{G}=\begin{bmatrix}
k_x.I_x\\ 
k_y.I_y\\ 
k_z.I_z
\end{bmatrix}
\label{magfield}
\end{equation}

where $k_x$, $k_y$ and $k_z$ are the coils constants ($T.m^{-1}.A^{-1}$) and $I_x$, $I_y$ and $I_z$ are the electrical current values.\par

The flux density is more complicated to calculate outside of the uniformity sphere. The same problem is present in our desktop experiment because the flux density and gradient are not constant. It is paramount to accurately compute the magnetic field to be able to calculate forces accurately. A method to calculate the field produced in all space by a solenoid assembly was used. It was tested on our desktop size experiment.\par
According to \cite{simpson2001simple}, the magnetic flux density produced by a current loop in all space can be calculated using equations \cref{Bz1loop,Bteta1loop,delta,beta,single_loop_geometry}.
\begin{equation}
B_z=\frac{\mu _0.I}{2.\pi.\delta ^{2}.\beta  }\left [ \left ( a^2-\rho ^2-z^2 \right )(E(k^2)+\delta ^2.K(k^2)) \right ] 
\label{Bz1loop}
\end{equation}
\begin{equation}
B_\theta=\frac{\mu _0.I.z}{2.\pi.\delta ^{2}.\beta.\rho   }\left [ \left ( a^2-\rho ^2-z^2 \right )(E(k^2)-\delta ^2.K(k^2)) \right ]
\label{Bteta1loop}
\end{equation}
\begin{equation}
\delta =\sqrt{a^2+R_m^2+Z_m^2-2.a.R_m}
\label{delta}
\end{equation}
\begin{equation}
\beta =\sqrt{a^2+R_m^2+Z_m^2+2.a.R_m}
\label{beta}
\end{equation}

\begin{figure}
  \includegraphics[width=\linewidth]{single_loop.eps}
  \caption{Geometry and variables used in equation \cref{Bz1loop,Bteta1loop,delta,beta}}
  \label{single_loop_geometry}
\end{figure}

The cross-section $S$ of any solenoid can be divided into infinitesimal sections $dS$. Each $dS$ is subjected to a current $dI=J.dS$. This current $dI$ forms an infinitesimal loop, and the field it produces can be calculated using \cref{Bz1loop,Bteta1loop,delta,beta}. By integrating this equation over the solenoid cross-section, one can obtain the value of the flux density generated by the solenoid.\par
The flux density has to be calculated for each solenoid. The total flux density is the vectorial sum of the flux density produced by each solenoid.

\begin{figure}
  \includegraphics[width=\linewidth]{Femm_matlab_comparison.png}
  \caption{Comparison between the flux density computed the semi-analytical method with Matlab and the flux density computed via a finite elements method with FEMM.}
  \label{Femm_matlab_comparison}
\end{figure}

\subsection{Magnetic force calculation}
\label{magforce}

This section aims at calculating the force applied by the magnetic field to the sphere.\par
The ferromagnetic sphere is small compared to the coil system and can be considered as a punctual infinitely small magnetic moment $\mathbf{m}$. Assuming a constant material magnetization $\mathbf{M}$, one can calculate $\mathbf{m}$ from \cref{mag}. $V$ is the volume of the sphere.
The ferromagnetic sphere is magnetized by the externally applied field $\mathbf{H_{app}}=\mathbf{B_{app}}/\mu_0$. Ferromagnetic materials create a demagnetizing field $\mathbf{Hd}$ when subjected to an external field. The actual field $\mathbf{H}$ seen by the sphere is the sum of $\mathbf{Happ}$ and $\mathbf{Hd}$. This effect has to be taken into account to calculate the magnetization accurately. $\mathbf{Hd}$ is related to $\mathbf{H_{app}}$ by \cref{hd}. The demagnetization factor $N$ for a sphere is -1/3. Its magnetization can be calculated using \cref{mag2}.
Once the magnetic moment $\mathbf{m}$ is obtained, the force on the sphere can be calculated using \cref{force}.

\begin{equation}
\label{mag}
\mathbf{m}=\mathbf{M}.V
\end{equation}

\begin{equation}
\mathbf{H_d}=N.\mathbf{H_{app}}
\label{hd}
\end{equation}

\begin{equation}
\mathbf{M}=\frac{\mathbf{H_{app}}\left ( \mu_r-1  \right )}{2.N.\mu_r-1}
\label{mag2}
\end{equation}

\begin{equation}
\mathbf{F}=\mathbf{\nabla}(\mathbf{m}.\mathbf{B})
\label{force}
\end{equation}

\subsection{Simulation results}
\label{simulation_results}
\begin{figure}
	\includegraphics[width=\linewidth]{delTvsVop_R3.eps}
	\caption{Time between impacts vs. initial velocity $v_{0^+}$, for different spring-end switching times $t_s$.}
	\label{delTvsVop}
\end{figure}

\begin{figure}
	\includegraphics[width=\linewidth]{delTvsTs_R2.eps}
	\caption{Time between impacts vs. switching times $t_s$, for different initial velocities $v_{0^+}$.}
	\label{delTvsTs}
\end{figure}

\begin{figure}
	\includegraphics[width=\linewidth]{Tswitch_cases_1to6.eps}
	\caption{Six domains for spring-end switching time; Red and Green represent $F_{mag}$ towards anterior and posterior respecively. Arrow represents ball motion direction.}
	\label{Tswitch}
\end{figure}


\begin{figure}
  \includegraphics[width=\linewidth]{close_vs_open_loop.eps}
  \caption{Geometry and variables used in equation \cref{Bz1loop,Bteta1loop,delta,beta}}
  \label{close_vs_open_loop}
\end{figure}


\section{Experimental determination of Impact coefficient of resititution}
\label{cor_det}
The coefficient of restitution $e$ was determined using the time interval between two consecutive bounces of the sphere when dropped from a given height, onto the impact rod. The measurements were made using 38.1 mm long impact rods for five different materials. Impact rods were held by a chuck. A length of 25.4 mm of the impact rods was sticking out of the chuck, as seen in figure \ref{CoR_setup_data}

\begin{figure}
	\includegraphics[width=\columnwidth]{CoR_setup_data.eps}
	\caption{Experimental setup for measuring the coefficient of restitution $e$}
	\label{CoR_setup_data}
\end{figure}

\begin{figure}
	\includegraphics[width=\columnwidth]{CoR_measurements.eps}
	\caption{Measured coefficient of restitution $e$ as a function of rods diameter for different materials}
	\label{CoR_Results}
\end{figure}





\section{Experimental magnetic hammer tests}
\label{experiment}
\subsection{Magnetic test bench description}

A desktop-size single axis magnetic setup was built to reduce the cost related to clinical MRI experiments. It is composed of two solenoid coils oriented along the same axis and separated by a distance $d$. The coils are used to produce both the magnetizing field and the gradient. The properties of the coils are shown in \cref{coil_table}.\par
The system is shown in figure \cref{magnetic_setup}. The two coils are held by an acrylic tube. They can slide and it and be locked in place to adjust the distance between the two coils and therefore change the maximum field and gradient values. The acrylic tube is transparent, allowing for visual access to the robot.
Each coil is powered via a Syren 25 switch mode power supply. A Hall-effect-based current sensor is used to perform a PID regulation of the current. It is necessary to control the current inside the coils and not only the voltage. Indeed, the produced magnetic field is directly proportional to the current whereas the voltage is related to the magnetic flux variation and the voltage drop produced by Joule effect losses.\par
Robots are inserted inside the acrylic tube holding the coils. They are held by a second, smaller tube that guides them along the system axis. Robots can be free to move along the coil axis or held in place. A picture of the system is provided in \cref{magnetic_setup}.

\begin{figure}
  \includegraphics[width=\linewidth]{Magnetic_setup.jpg}
  \caption{Picture of the desktop-size magnetic setup.}
  \label{magnetic_setup}
\end{figure}

\begin{table}[]
\centering
\caption{Properties of the coils used in the desktop-size test bench}
\label{coil_table}
\begin{tabular}{|l|l||l|l|}
\hline
Internal Radius    & 12.7 mm                   & Electrical resistance                                                                      & 0.16 $\Omega$       \\ \hline
External Radius    & 45.8 mm                   & Inductance                                                                                 & 1.59 mH    \\ \hline
Length             & 65 mm                     & \begin{tabular}[c]{@{}l@{}}Max current change rate \\ Voltage = 25 V\end{tabular}          & 15,700 A/s \\ \hline
Wire               & 10 AWG                    & Maximum continuous current                                                                 & 15 A       \\ \hline
Wire cross-section & 5.26 mm\textasciicircum 2 & \begin{tabular}[c]{@{}l@{}}Flux density on system center\\ I = 15 A d = 50 mm\end{tabular} & 11 mT      \\ \hline
Number of turns    & 265                       & \begin{tabular}[c]{@{}l@{}}Gradient on system center\\  I = 15 A d = 50 mm\end{tabular}    & 0.45 T/m   \\ \hline
\end{tabular}
\end{table}


\subsection{Partially closed loop experiment}

The coils are driven by square shaped currents. The current in the coils can either be $I_{max}$ or 0 A. The coil will be said to be “on” when $I=I_{max}$ and “off” when $I=0$ A.\par
As explained in \cref{simulation_results}, the magnetic hammer cannot work properly if the magnetic field is not synchronized with the position of the sphere. An open loop control is indeed inefficient. The force applied on the sphere (and therefore the magnetic gradient) must change direction when the sphere hits the impact plate and when the sphere changes direction on the spring side to provide maximum impulse.\par
Our eventual goal is to use these robots in an MRI scanner, where MRI gradients must be shared for propulsion and position feedback \cite{578}. The nature of our system enables simpler sensing requirements that can be accomplished with a simple microphone. The microphone is used to monitor the noise produced by the system. The impact noise creates a larger pulsed signal on the microphone output and can, therefore, be easily detected. When the impact is detected, the anterior coil is turned off while the posterior coil is turned on. The force applied on the sphere now pushes it backward, toward the spring side.\par
The current stays constant during a time $T_{back}$ after the impact is detected. The anterior coil is subsequently turned on, and the posterior coil is turned off. The force then pushes the sphere forward. The current in the coils is changed again when another impact is detected. This process is repeated indefinitely.\par
$T_{back}$ is manually tuned while the system is working. It is set to the value that gives the maximum oscillating frequency. This value corresponds to a gradient that changes direction when the sphere velocity is zero on the spring side. It indeed should give the same results as the perfectly closed loop simulations.\par
The partially closed loop experiment was performed and compared to the model. \cref{experiment} shows a comparison of the optimum oscillating frequency as a function of $I_{max}$. The simulations are here performed for a perfectly closed loop system. On can see first that when $I_{max}$ increases, the oscillating frequency increases. The force on the sphere indeed increases with $I_{max}$ and consequently increases the moving speed of the sphere.
This figure also shows that the model without friction has the same slope as the experimental data. However, the simulations signals are approximately 1 Hz faster than the experimentation. This difference probably comes from the lack of friction in the modelization. The effect of friction has indeed been added into the model. It is presented in the next subsection.

\begin{figure}
\label{experiment}
  \includegraphics[width=\linewidth]{figure3.eps}
  \caption{Comparison between the oscillating frequency obtained experimentally and with the model as a function of the current in the coils $I_{max}$}
  \label{freq}
\end{figure}

\subsection{Effect of friction}

In order to improve the model accuracy, the friction between the moving sphere and the other components of the millirobot was included into the model. The sphere can be rolling or sliding inside the tube. The modelization is based on the method described in \cite{00319120303009}. The rotation speed $\omega$ is first computed and drag is calculated from this result.\par
The friction on the tube produces a torque on the sphere. It is assumed that the coefficient of static friction is equal to the coefficient of kinetic friction $\mu_k$. The equation used to calculate the angular velocity variation $\frac{\mathrm{d\omega } }{\mathrm{d} t}$ of the sphere is different whether the sphere is rolling or sliding. The distinction between this two different behavior is made by calculating the relative velocities $V_{rel}$ of the sphere and the tube surface (see \cref{relV}). \par


\begin{equation}
V_{rel}=V-r\omega
\label{relV}
\end{equation}

 
If the relative speed is inferior to 0.005 m/s and if the force applied to the sphere is smaller than the kinetic friction, the sphere is considered to be rolling inside the tube and the drag is null. $\frac{\mathrm{d\omega } }{\mathrm{d} t}$ can be calculated with:

\begin{equation}
\frac{\mathrm{d\omega } }{\mathrm{d} t}=r\frac{\mathrm{dV } }{\mathrm{d} t}
\label{domega}
\end{equation}

In all other cases, the torque applied to the sphere is equal to the kinetic friction force multiplied by the sphere radius. The drag is equal to the kinetic friction force.

%\section{Tissue penetration test}
%\begin{table}[h]
%\caption{An Example of a Table}
%\label{table_example}
%\begin{center}
%\begin{tabular}{|c||c|}
%\hline
%One & Two\\
%\hline
%Three & Four\\
%\hline
%\end{tabular}
%\end{center}
%\end{table}


%   \begin{figure}[thpb]
%      \centering
%      \framebox{\parbox{3in}{We suggest that you use a text box to insert a graphic (which is ideally a 300 dpi TIFF or EPS file, with all fonts embedded) because, in an document, this method is somewhat more stable than directly inserting a picture.
%}}
%      %\includegraphics[scale=1.0]{figurefile}
%      \caption{Inductance of oscillation winding on amorphous
 %      magnetic core versus DC bias magnetic field}
 %     \label{figurelabel}
 %  \end{figure}
\section{Preliminary tests in clinical MRI}
\label{MRI_tests}
Preliminary tests of magnetic hammers were performed into a clinical 1.5T Siemens MRI scanner. No closed loop control was implemented. The magnetic gradient was oscillating at a constant frequency. As seen before, the system does not work properly in these conditions. At low frequencies, the ferromagnetic sphere completely stops on both sides of the millirobot. All the kinetic energy is lost at these times, and the magnetic hammer, therefore, exhibits very poor performances. The aim of this tests is to prove that MRI scanners are suitable to produce the desired force on the magnetic sphere inside the millirobot and provide a pulsed force.\par
A 50 mm long, 7 mm diameter robot was build for this test. A 2Hz square gradient with an amplitude of 23 mT/m was applied to it. This frequency is slow enough to allow the sphere to stop on both sides completely. A sample of sheep brain was used as a tissue sample to penetrate.\par
Once the gradient wave was started, the sphere began to move back and forth while the robot was moving toward the sample at each impact. The robot then began to penetrate the sample. It went 9 mm deep inside it and stopped progressing (see\cref{MRI_test}). 
This experiment demonstrated the suitability of MRI scanner to drive magnetic hammers. However, a closed loop control now needs to be implemented on the MRI scanner to produce an efficient energy transfer. \par
Our team is currently working on obtaining the closed loop control into the clinical MRI scanner. The MRI signal will be used to compute the position of the magnetic sphere at a frequency greater than 20 Hz.

\begin{figure}
\centering
  \includegraphics[width=150 pt]{tests_in_MRI.png}
  \caption{Picture of the magnetic hammer driven by an MRI scanner. The penetration test is realized on a sheep brain sample.}
  \label{MRI_test}
\end{figure}

\section{CONCLUSIONS}
\label{conclusion}
A magnetic hammer system for millirobot driven by MRI scanners was studied. The system allows producing large pulsed forces in order to penetrate body tissue.\par
The hammer is composed of a ferromagnetic sphere moving inside a tube. On the posterior side of the robot, there is a spring that allows changing the direction of the sphere smoothly. On the anterior side, a hard metal rod act as an impact plate to transfer the momentum of the ferromagnetic sphere to the body of the robot.\par
The system is driven by an external magnetic field, produced by an MRI scanner. The main field magnetizes the sphere and the gradient produces the forces necessary to move the sphere.\par
 A complex modelization allows the computation of the position of the sphere as a function of the time. The magnetic flux density and the gradient are computed using a semi-analytical method and allow an accurate calculation of the force applied to the sphere. The speed of the sphere after impact is computed from the coefficient of restitution. The rotation of the sphere is also calculated, allowing an accurate calculation of the drag produced by the sliding of the sphere inside the tube.\par
The coefficients of restitutions (CoR) depends on the materials of the colliding objects but also on their shape and sizes. CoR values were experimentally measured. These measurements showed that Titanium impact plates exhibit large CoR. This material also has the advantage of being lightweight, useful property to achieve neutral buoyancy of millirobots. In additions, Titanium is a bio-compatible material. This makes Titanium the best choice for impact plates of magnetic hammers.\par
A desktop-size magnetic test bench was built to reduce experimental cost related to the use of a clinical MRI scanner. A magnetic hammer was tested with a partially closed loop control. The impact of the sphere is detected via a microphone. The posterior coil is turn on during a predetermined time to pull the sphere backward. After this time, the posterior coil is turned off and the anterior coil is turned on until the next impact is detected. Experimental results were compared to the model. The experimental oscillating frequency is in good agreement with the model predictions. This allows to validate our modelization.\par
In future work, the control of the magnetic hammer will be implemented and tested into a clinical MRI scanner. The impact will be detected with the MRI signal instead of a microphone. The miniaturization of the robot will also be studied.

 

\addtolength{\textheight}{-12cm}   % This command serves to balance the column lengths
                                  % on the last page of the document manually. It shortens
                                  % the textheight of the last page by a suitable amount.
                                  % This command does not take effect until the next page
                                  % so it should come on the page before the last. Make
                                  % sure that you do not shorten the textheight too much.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{unsrt}
\bibliography{biblio}



\end{document}
